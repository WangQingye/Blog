<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author" content="清野君"><title>重温ES6 - 3 · 清野流云</title><meta name="description" content="公司中老项目是运用ES5写成了，现在全面升级ES6，固将以前学习过ES6的知识在重温一遍。
Proxy和Reflect1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950"><meta name="keywords"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><link rel="short icon" href="/images/favicon.png" type="image/x-icon"><link rel="stylesheet" href="/Blog/css/style.css"><link rel="stylesheet" href="/Blog/css/blog_basic.css"><link rel="stylesheet" href="/Blog/css/font-awesome.min.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"></head><body><div class="sidebar animated fadeInDown"><div class="logo-title"><div class="title"><img src="/Blog/images/logo@2x.png" style="width:127px;"><h3 title=""><a href="/">清野流云</a></h3></div></div><ul class="social-links"></ul><div class="footer"><!-- a(target="_blank", href="/")--><!--   span Theme by --><!-- a(href="https://www.caicai.me")  CaiCai --><!-- span &--><!-- a(href="https://github.com/Ben02/hexo-theme-Anatole")  Ben--><!-- .by_farbox--><!--   a(href="https://hexo.io/zh-cn/", target="_blank") Proudly published with Hexo&#65281;--></div></div><div class="main"><div class="page-top animated fadeInDown"><div class="nav"><li><a href="http://wqy.fun/Blog">首页</a></li><!-- li--><!--   if is_current('about')--><!--     a.current(href="/about")= __('About')			--><!--   else--><!--     a(href="/about")= __('About')--><li><a href="http://wqy.fun/Blog/archives">归档</a></li><!-- li--><!--   if is_current('links')--><!--     a.current(href="/links")= __('Links')					--><!--   else--><!--     a(href="/links")= __('Links')		--></div><div class="information"><div class="back_btn"><li><a onclick="window.history.go(-1)" class="fa fa-chevron-left"> </a></li></div><div class="avatar"><img></div></div></div><div class="autopagerize_page_element"><div class="content"><div class="post-page"><div class="post animated fadeInDown"><div class="post-title"><h3><a>重温ES6 - 3</a></h3></div><div class="post-content"><p>公司中老项目是运用ES5写成了，现在全面升级ES6，固将以前学习过ES6的知识在重温一遍。</p>
<h2 id="Proxy和Reflect"><a href="#Proxy和Reflect" class="headerlink" title="Proxy和Reflect"></a>Proxy和Reflect</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Proxy</span></div><div class="line">&#123;</div><div class="line">  <span class="keyword">let</span> obj = &#123;</div><div class="line">    time: <span class="string">'2017-03-11'</span>,</div><div class="line">    name: <span class="string">'net'</span>,</div><div class="line">    _r: <span class="number">213</span></div><div class="line">  &#125;;</div><div class="line">  <span class="comment">// 通过一个代理来操作对象</span></div><div class="line">  <span class="keyword">let</span> monitor = <span class="keyword">new</span> <span class="built_in">Proxy</span>(obj,&#123;</div><div class="line">    <span class="comment">// 拦截对象属性的读取（可以进行一定的操作，但是不影响原对象）</span></div><div class="line">    get(target, key)&#123;</div><div class="line">      <span class="keyword">return</span> target[key].replace(<span class="string">'2017'</span>, <span class="string">'2018'</span>);</div><div class="line">    &#125;,    </div><div class="line">    <span class="comment">// 拦截对象的设置</span></div><div class="line">    set(target, key, value)&#123;</div><div class="line">      <span class="comment">// 只允许修改name</span></div><div class="line">      <span class="keyword">if</span> (key === <span class="string">'name'</span>) &#123;</div><div class="line">        <span class="keyword">return</span> target[key] = value;</div><div class="line">      &#125;<span class="keyword">else</span>&#123;</div><div class="line">        <span class="keyword">return</span> target[key];</div><div class="line">      &#125;</div><div class="line">    &#125;,</div><div class="line">    <span class="comment">// 拦截判断</span></div><div class="line">    has(target, key)&#123;</div><div class="line">      <span class="comment">// 只暴露name</span></div><div class="line">      <span class="keyword">if</span> (key === <span class="string">'name'</span>)&#123;</div><div class="line">        <span class="keyword">return</span> target[key]</div><div class="line">      &#125;<span class="keyword">else</span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">      &#125;</div><div class="line">    &#125;,</div><div class="line">    <span class="comment">// 拦截删除</span></div><div class="line">    deleteProperty(target, key)&#123;</div><div class="line">      <span class="comment">// 只能删除下划线开头的属性</span></div><div class="line">      <span class="keyword">if</span> (key.indexOf(<span class="string">'_'</span>) == <span class="number">0</span>)&#123;</div><div class="line">        <span class="keyword">delete</span> target</div><div class="line">      &#125;</div><div class="line">    &#125;,</div><div class="line">    <span class="comment">// 拦截Obeject.keys, Object.getOwnPropertySymbols,Object.getOwnPropertyNames</span></div><div class="line">    ownKeys(target)&#123;</div><div class="line">      <span class="comment">// 保护time属性</span></div><div class="line">      <span class="keyword">return</span> <span class="built_in">Object</span>.keys(target).filter(<span class="function"><span class="params">item</span> =&gt;</span> item!= <span class="string">'time'</span>)</div><div class="line">    &#125;</div><div class="line">  &#125;);</div><div class="line">  monitor.time <span class="comment">// 2018-03-11</span></div><div class="line">  time <span class="keyword">in</span> monitor <span class="comment">// false</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//	Reflect</span></div><div class="line">&#123;</div><div class="line">  <span class="keyword">let</span> obj = &#123;</div><div class="line">    time: <span class="string">'2017-03-11'</span>,</div><div class="line">    name: <span class="string">'net'</span>,</div><div class="line">    _r: <span class="number">213</span></div><div class="line">  &#125;;</div><div class="line">  <span class="comment">// Reflect跟Proxy的方法是一样的</span></div><div class="line">  <span class="built_in">Reflect</span>.get(obj, <span class="string">'time'</span>) <span class="comment">// 2017-03-11</span></div><div class="line">  <span class="built_in">Reflect</span>.set(obj, <span class="string">'name'</span>, <span class="string">'newname'</span>)</div><div class="line">  <span class="built_in">Reflect</span>.has(obj, <span class="string">'name'</span>)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 例子（解耦验证）</span></div><div class="line">&#123;</div><div class="line">  <span class="comment">// 传入一个对象和验证器</span></div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">validator</span>(<span class="params">target, validator</span>)</span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Proxy</span>(target, &#123;</div><div class="line">      _validator: validator,</div><div class="line">      set(target, key, value, proxy)&#123;</div><div class="line">        <span class="keyword">if</span> (target.hasOwnProperty(key))&#123;</div><div class="line">          <span class="keyword">let</span> va = <span class="keyword">this</span>._validator[key];</div><div class="line">          <span class="keyword">if</span> (!!va(value))&#123;</div><div class="line">            <span class="comment">// var a; b=!!a; a默认是undefined。!a是true，!!a则是false，所以b的值是false，而不再是undefined，也非其它值，主要是为后续判断提供便利。</span></div><div class="line">            <span class="keyword">return</span> <span class="built_in">Reflect</span>.set(target, key, value, proxy)</div><div class="line">          &#125;<span class="keyword">else</span>&#123;</div><div class="line">            <span class="keyword">throw</span> <span class="built_in">Error</span>(<span class="string">`不能设置<span class="subst">$&#123;key&#125;</span>到<span class="subst">$&#123;value&#125;</span>`</span>);</div><div class="line">          &#125;</div><div class="line">        &#125;<span class="keyword">else</span>&#123;</div><div class="line">          <span class="keyword">throw</span> <span class="built_in">Error</span>(<span class="string">`<span class="subst">$&#123;key&#125;</span>不存在`</span>)</div><div class="line">        &#125;</div><div class="line">      &#125;</div><div class="line">    &#125;)</div><div class="line">  &#125;</div><div class="line">  </div><div class="line">  <span class="comment">// 验证器</span></div><div class="line">  <span class="keyword">const</span> perValidators = &#123;</div><div class="line">    name(val)&#123;</div><div class="line">      <span class="keyword">return</span> <span class="keyword">typeof</span> val === <span class="string">'string'</span></div><div class="line">    &#125;,</div><div class="line">    age(val)&#123;</div><div class="line">      <span class="keyword">return</span> <span class="keyword">typeof</span> val === <span class="string">'number'</span> &amp;&amp; val &gt; <span class="number">18</span></div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">  </div><div class="line">  <span class="comment">// 对象</span></div><div class="line">  <span class="class"><span class="keyword">class</span> <span class="title">Person</span></span>&#123;</div><div class="line">    <span class="keyword">constructor</span>(name, age)&#123;</div><div class="line">      <span class="keyword">this</span>.name = name;</div><div class="line">      <span class="keyword">this</span>.age = age;</div><div class="line">      <span class="keyword">return</span> validator(<span class="keyword">this</span>, personValidators)</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">  </div><div class="line">  <span class="keyword">const</span> person = <span class="keyword">new</span> Person(<span class="string">'lilei'</span>, <span class="number">30</span>);</div><div class="line">  <span class="built_in">console</span>.log(person) <span class="comment">// &#123;name:'lilei', age:'30'&#125;;</span></div><div class="line">  <span class="keyword">const</span> person = <span class="keyword">new</span> Person(<span class="string">'lilei'</span>, <span class="number">15</span>);</div><div class="line">  <span class="built_in">console</span>.log(person) <span class="comment">// 报错，不能设置age到15</span></div><div class="line">  </div><div class="line">  <span class="comment">// 这样的好处就是条件和对象完全分离，可细细体会。</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="类和对象"><a href="#类和对象" class="headerlink" title="类和对象"></a>类和对象</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="comment">// 基本定义和生成实例</span></div><div class="line">  <span class="class"><span class="keyword">class</span> <span class="title">Parent</span></span>&#123;</div><div class="line">    <span class="keyword">constructor</span>( name = "default" )&#123;</div><div class="line">      <span class="keyword">this</span>.name = name;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">// getter 和 setter, 在赋值和取值时可以进行一定操作</span></div><div class="line">    get longName()&#123;</div><div class="line">      <span class="keyword">return</span> <span class="string">'test'</span> + <span class="keyword">this</span>.name</div><div class="line">    &#125;</div><div class="line">    set longName()&#123;</div><div class="line">      <span class="keyword">this</span>.name = value</div><div class="line">    &#125;    </div><div class="line">    <span class="comment">// 静态方法</span></div><div class="line">    <span class="keyword">static</span> tell()&#123;</div><div class="line">      <span class="built_in">console</span>.log(<span class="string">'tell'</span>)</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">  Parent.age = <span class="number">18</span>; <span class="comment">//静态属性</span></div><div class="line">  <span class="keyword">let</span> v_parent = <span class="keyword">new</span> Parent(<span class="string">'v'</span>);</div><div class="line">  <span class="built_in">console</span>.log(<span class="string">'构造函数和实例'</span>, v_parent); <span class="comment">// &#123;name: v, age = 18&#125;</span></div><div class="line">  </div><div class="line">  <span class="comment">// 继承</span></div><div class="line">  <span class="class"><span class="keyword">class</span> <span class="title">Child</span> <span class="keyword">extends</span> <span class="title">Parent</span></span>&#123;</div><div class="line">    <span class="keyword">constructor</span>(name = 'child')&#123;</div><div class="line">      <span class="keyword">super</span>(name); <span class="comment">// super 其实就是父类的构造函数 , 另外super需要放在第一行</span></div><div class="line">      <span class="keyword">this</span>.type = <span class="string">'child'</span>;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">  <span class="built_in">console</span>.log(<span class="keyword">new</span> Child()); <span class="comment">// &#123;name: default, age = 18&#125;</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="Promise"><a href="#Promise" class="headerlink" title="Promise"></a>Promise</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="comment">// 异步解决方案</span></div><div class="line">  <span class="comment">// 基本结构</span></div><div class="line">  <span class="keyword">let</span> ajax = <span class="function"><span class="keyword">function</span>(<span class="params">num</span>)</span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'test'</span>);</div><div class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>)</span>&#123;</div><div class="line">		<span class="keyword">if</span>(num &gt; <span class="number">5</span>)&#123;</div><div class="line">          resolve();</div><div class="line">		&#125;<span class="keyword">else</span>&#123;</div><div class="line">          <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'出错'</span>)</div><div class="line">		&#125;</div><div class="line">    &#125;)</div><div class="line">  &#125;</div><div class="line">  ajax(<span class="number">6</span>).then(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'good'</span>); </div><div class="line">  &#125;).catch(<span class="function"><span class="keyword">function</span>(<span class="params">err</span>)</span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'catch'</span>,err)</div><div class="line">  &#125;)</div><div class="line">  </div><div class="line">  <span class="comment">// 基本使用例子</span></div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">loadImg</span>(<span class="params">src</span>)</span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</div><div class="line">      <span class="keyword">let</span> img = <span class="built_in">document</span>.createElement(<span class="string">'img'</span>);</div><div class="line">      img.src = src;</div><div class="line">      img.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        resolve(img);</div><div class="line">      &#125;</div><div class="line">      img.onerror = <span class="function"><span class="keyword">function</span>(<span class="params">err</span>)</span>&#123;</div><div class="line">        reject(err);</div><div class="line">      &#125;</div><div class="line">    &#125;)</div><div class="line">  &#125;</div><div class="line">  </div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">showImgs</span>(<span class="params">imgs</span>)</span>&#123;</div><div class="line">    imgs.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">img</span>)</span>&#123;</div><div class="line">      <span class="built_in">document</span>.body.appendChild(img);</div><div class="line">    &#125;)</div><div class="line">  &#125;</div><div class="line">  <span class="comment">// 必须三张图片都加载完再执行then</span></div><div class="line">  <span class="built_in">Promise</span>.all([</div><div class="line">    loadImg(<span class="string">'http://i4.buimg.com/567571/dasdasd.png'</span>);                                       loadImg(<span class="string">'http://i4.buimg.com/567571/dasdasd.png'</span>);</div><div class="line">    loadImg(<span class="string">'http://i4.buimg.com/567571/dasdasd.png'</span>);</div><div class="line">  ]).then(showImgs);</div><div class="line">  <span class="comment">// 只完成一个就执行then，并且不执行其他的了</span></div><div class="line">  <span class="built_in">Promise</span>.race([</div><div class="line">    loadImg(<span class="string">'http://i4.buimg.com/567571/dasdasd.png'</span>);                                       loadImg(<span class="string">'http://i4.buimg.com/567571/dasdasd.png'</span>);</div><div class="line">    loadImg(<span class="string">'http://i4.buimg.com/567571/dasdasd.png'</span>);</div><div class="line">  ]).then(showImgs);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="Iterator-和-for-of-循环"><a href="#Iterator-和-for-of-循环" class="headerlink" title="Iterator 和 for of 循环"></a>Iterator 和 for of 循环</h2><p>for of 是专门针对具有Iterator接口的数据结构来读取数据。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 数组</span></div><div class="line">&#123;</div><div class="line">  <span class="keyword">let</span> arr = [<span class="string">'hello'</span>, <span class="string">'world'</span>];</div><div class="line">  <span class="keyword">let</span> map = arr[<span class="built_in">Symbol</span>.iterator]();</div><div class="line">  <span class="built_in">console</span>.log(map.next());  <span class="comment">// &#123;value: 'hello', done: false&#125;</span></div><div class="line">  <span class="built_in">console</span>.log(map.next());  <span class="comment">// &#123;value: 'world', done: false&#125;</span></div><div class="line">  <span class="built_in">console</span>.log(map.next());  <span class="comment">// &#123;value: undifined, done: false&#125;</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 自定义Iterator接口</span></div><div class="line">&#123;</div><div class="line">  <span class="keyword">let</span> obj = &#123;</div><div class="line">    start: [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>],</div><div class="line">    end: [<span class="number">7</span>,<span class="number">9</span>,<span class="number">8</span>],</div><div class="line">    [<span class="built_in">Symbol</span>.iterator]()&#123;</div><div class="line">      <span class="keyword">let</span> self = <span class="keyword">this</span>;</div><div class="line">      <span class="keyword">let</span> index = <span class="number">0</span>;</div><div class="line">      <span class="keyword">let</span> arr = self.start.concat(self.end);</div><div class="line">      <span class="keyword">let</span> len = arr.length;</div><div class="line">      <span class="keyword">return</span> &#123;</div><div class="line">        next()&#123;</div><div class="line">          <span class="keyword">if</span> (index &lt; len)&#123;</div><div class="line">            <span class="keyword">return</span> &#123;</div><div class="line">              value: arr[index++],</div><div class="line">              done: <span class="literal">false</span></div><div class="line">            &#125;</div><div class="line">          &#125;<span class="keyword">else</span>&#123;</div><div class="line">            <span class="keyword">return</span> &#123;</div><div class="line">              value: arr[index++],</div><div class="line">              done: <span class="literal">true</span></div><div class="line">            &#125;</div><div class="line">          &#125;</div><div class="line">        &#125;</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">of</span> obj)&#123;</div><div class="line">    <span class="built_in">console</span>.log(key); <span class="comment">// 1 3 2 7 9 8</span></div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="Generator"><a href="#Generator" class="headerlink" title="Generator"></a>Generator</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 基本用法</span></div><div class="line">&#123;</div><div class="line">  <span class="keyword">let</span> tell = <span class="function"><span class="keyword">function</span>* (<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="keyword">yield</span> <span class="string">'a'</span>;</div><div class="line">    <span class="keyword">yield</span> <span class="string">'b'</span>;</div><div class="line">    <span class="keyword">return</span> c;</div><div class="line">  &#125;  </div><div class="line">  <span class="keyword">let</span> k = tell();</div><div class="line">  </div><div class="line">  <span class="built_in">console</span>.log(k.next());  <span class="comment">// &#123;value: 'a', done: false&#125;</span></div><div class="line">  <span class="built_in">console</span>.log(k.next());  <span class="comment">// &#123;value: 'b', done: false&#125;</span></div><div class="line">  <span class="built_in">console</span>.log(k.next());  <span class="comment">// &#123;value: 'c', done: false&#125;</span></div><div class="line">  <span class="built_in">console</span>.log(k.next());  <span class="comment">// &#123;value: undefined, done: true&#125;</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 使用generator至少iterator接口</span></div><div class="line">&#123;</div><div class="line">  <span class="keyword">let</span> obj = &#123;&#125;;</div><div class="line">  obj[<span class="built_in">Symbol</span>.iterator] = <span class="function"><span class="keyword">function</span>*(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="keyword">yield</span> <span class="number">1</span>;</div><div class="line">    <span class="keyword">yield</span> <span class="number">2</span>;</div><div class="line">    <span class="keyword">yield</span> <span class="number">3</span>;</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> value <span class="keyword">of</span> obj)&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'value'</span>, value); <span class="comment">// value 1 value 2 value 3</span></div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// Generator适用场景之状态机</span></div><div class="line">&#123;</div><div class="line">  <span class="keyword">let</span> state = <span class="function"><span class="keyword">function</span>*(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="keyword">while</span>(<span class="number">1</span>)&#123;</div><div class="line">      <span class="keyword">yield</span> <span class="string">'A'</span>;</div><div class="line">      <span class="keyword">yield</span> <span class="string">'B'</span>;</div><div class="line">      <span class="keyword">yield</span> <span class="string">'C'</span>;</div><div class="line">    &#125;</div><div class="line">  &#125;  </div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 实例1 - 次数限制</span></div><div class="line">&#123;</div><div class="line">  <span class="keyword">let</span> draw = <span class="function"><span class="keyword">function</span>(<span class="params">count</span>)</span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'剩余$&#123;count&#125;次'</span>)</div><div class="line">  &#125;</div><div class="line">  </div><div class="line">  <span class="keyword">let</span> residue = <span class="function"><span class="keyword">function</span>*(<span class="params">count</span>)</span>&#123;</div><div class="line">    <span class="keyword">while</span> (count &gt; <span class="number">0</span>)&#123;</div><div class="line">      count --;</div><div class="line">      <span class="keyword">yield</span> draw(count);</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">  </div><div class="line">  <span class="keyword">let</span> star = residue(<span class="number">5</span>);</div><div class="line">  <span class="keyword">let</span> btn = <span class="built_in">document</span>.createElement(<span class="string">'button'</span>);</div><div class="line">  btn.id = <span class="string">'start'</span>;</div><div class="line">  btn.textContent = <span class="string">'抽奖'</span>;</div><div class="line">  <span class="built_in">document</span>.body.appendChild(btn);</div><div class="line">  <span class="built_in">document</span>.getElementById(<span class="string">'start'</span>).addEventListener(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    star.next();</div><div class="line">  &#125;,<span class="literal">false</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 实例2 - 长轮询</span></div><div class="line">&#123;</div><div class="line">  <span class="keyword">let</span> ajax = <span class="function"><span class="keyword">function</span>* (<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="keyword">yield</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>)</span>&#123;</div><div class="line">      setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        resolve(&#123;<span class="attr">code</span>: <span class="number">0</span>&#125;)</div><div class="line">      &#125;, <span class="number">200</span>)</div><div class="line">    &#125;)</div><div class="line">  &#125;</div><div class="line">  </div><div class="line">  <span class="keyword">let</span> pull = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="keyword">let</span> generator = ajax();</div><div class="line">    <span class="keyword">let</span> step = generator.next();</div><div class="line">    step.value.then(<span class="function"><span class="keyword">function</span>(<span class="params">d</span>)</span>&#123;</div><div class="line">      <span class="keyword">if</span> (d.code != <span class="number">0</span>)&#123;</div><div class="line">        setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">          <span class="built_in">console</span>.log(<span class="string">'wait'</span>);</div><div class="line">          pull();</div><div class="line">        &#125;,<span class="number">1000</span>)</div><div class="line">      &#125;<span class="keyword">else</span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(d)</div><div class="line">      &#125;</div><div class="line">    &#125;)</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2017-09-29</span><i class="fa fa-tag"></i><a href="/Blog/tags/javascript/" title="javascript" class="tag">javascript </a><a href="/Blog/tags/ES6/" title="ES6" class="tag">ES6 </a></div></div></div></div><div class="share"><div class="evernote"><a href="javascript:(function(){EN_CLIP_HOST='http://www.evernote.com';try{var%20x=document.createElement('SCRIPT');x.type='text/javascript';x.src=EN_CLIP_HOST+'/public/bookmarkClipper.js?'+(new%20Date().getTime()/100000);document.getElementsByTagName('head')[0].appendChild(x);}catch(e){location.href=EN_CLIP_HOST+'/clip.action?url='+encodeURIComponent(location.href)+'&amp;title='+encodeURIComponent(document.title);}})();" ref="nofollow" target="_blank" class="fa fa-bookmark"></a></div><div class="weibo"><a href="javascript:void((function(s,d,e){try{}catch(e){}var f='http://service.weibo.com/share/share.php?',u=d.location.href,p=['url=',e(u),'&amp;title=',e(d.title),'&amp;appkey=2924220432'].join('');function a(){if(!window.open([f,p].join(''),'mb',['toolbar=0,status=0,resizable=1,width=620,height=450,left=',(s.width-620)/2,',top=',(s.height-450)/2].join('')))u.href=[f,p].join('');};if(/Firefox/.test(navigator.userAgent)){setTimeout(a,0)}else{a()}})(screen,document,encodeURIComponent));" class="fa fa-weibo"></a></div><div class="twitter"><a href="http://twitter.com/home?status=,http://wqy.fun/Blog/2017/09/29/重温ES6-3/,清野流云,重温ES6 - 3,;" class="fa fa-twitter"></a></div></div><div class="pagination"><ul class="clearfix"><li class="pre pagbuttons"><a role="navigation" href="/Blog/2019/05/07/vue自定义指令/" title="Vue 自定义指令" class="btn">上一篇</a></li><li class="next pagbuttons"><a role="navigation" href="/Blog/2017/09/28/重温ES6-2/" title="重温ES6 - 2" class="btn">下一篇</a></li></ul></div></div></div></div></div><script src="/Blog/js/jquery.js"></script><script src="/Blog/js/jquery-migrate-1.2.1.min.js"></script><script src="/Blog/js/jquery.appear.js"></script></body></html>