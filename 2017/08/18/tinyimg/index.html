<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author" content="清野君"><title>一个一键压缩图片的小脚本 · 清野流云</title><meta name="description" content="新公司的项目中，因为单个项目都比较小，所以并没有引入打包工具(gulp或者webpack等)，大家普遍在自己去tinypng网站自己压缩图片。面对这个问题，就自己写了一个小脚本，通过调用tinypng的API实现一键压缩。
目的：压缩指定文件夹下的png和jpg图片。
原理：采用tinypng的ap"><meta name="keywords"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><link rel="short icon" href="/images/favicon.png" type="image/x-icon"><link rel="stylesheet" href="/Blog/css/style.css"><link rel="stylesheet" href="/Blog/css/blog_basic.css"><link rel="stylesheet" href="/Blog/css/font-awesome.min.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"></head><body><div class="sidebar animated fadeInDown"><div class="logo-title"><div class="title"><img src="/Blog/images/logo@2x.png" style="width:127px;"><h3 title=""><a href="/">清野流云</a></h3></div></div><ul class="social-links"></ul><div class="footer"><!-- a(target="_blank", href="/")--><!--   span Theme by --><!-- a(href="https://www.caicai.me")  CaiCai --><!-- span &--><!-- a(href="https://github.com/Ben02/hexo-theme-Anatole")  Ben--><!-- .by_farbox--><!--   a(href="https://hexo.io/zh-cn/", target="_blank") Proudly published with Hexo&#65281;--></div></div><div class="main"><div class="page-top animated fadeInDown"><div class="nav"><li><a href="http://wqy.fun/Blog">首页</a></li><!-- li--><!--   if is_current('about')--><!--     a.current(href="/about")= __('About')			--><!--   else--><!--     a(href="/about")= __('About')--><li><a href="http://wqy.fun/Blog/archives">归档</a></li><!-- li--><!--   if is_current('links')--><!--     a.current(href="/links")= __('Links')					--><!--   else--><!--     a(href="/links")= __('Links')		--></div><div class="information"><div class="back_btn"><li><a onclick="window.history.go(-1)" class="fa fa-chevron-left"> </a></li></div><div class="avatar"><img></div></div></div><div class="autopagerize_page_element"><div class="content"><div class="post-page"><div class="post animated fadeInDown"><div class="post-title"><h3><a>一个一键压缩图片的小脚本</a></h3></div><div class="post-content"><p>新公司的项目中，因为单个项目都比较小，所以并没有引入打包工具(gulp或者webpack等)，大家普遍在自己去tinypng网站自己压缩图片。面对这个问题，就自己写了一个小脚本，通过调用tinypng的API实现一键压缩。</p>
<h3 id="目的："><a href="#目的：" class="headerlink" title="目的："></a>目的：</h3><p>压缩指定文件夹下的png和jpg图片。</p>
<h3 id="原理："><a href="#原理：" class="headerlink" title="原理："></a>原理：</h3><p>采用tinypng的api，优点是压缩度大，质量好，缺点是每月限额500张。</p>
<h3 id="开发过程："><a href="#开发过程：" class="headerlink" title="开发过程："></a>开发过程：</h3><ol>
<li><p>引入了一个叫做tinify的npm包：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> tinify = <span class="built_in">require</span>(<span class="string">"tinify"</span>);</div><div class="line"></div><div class="line"><span class="comment">/* 这个api是在 https://tinypng.com/developers 申请的，每个邮箱每个月只能压500张 */</span></div><div class="line"></div><div class="line">tinify.key = <span class="string">"lgwr26XdUj-ExIlL8O_mPwb1-Uadp5fL"</span>;</div><div class="line"></div><div class="line">tinify.fromFile(filePath).toFile(filePath);</div></pre></td></tr></table></figure>
</li>
<li><p>扫描一个指定文件夹里所有png和jpg图片：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">readFile</span>(<span class="params">path</span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> files = fs.readdirSync(path);</div><div class="line">    files.forEach(ergodic);</div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">ergodic</span>(<span class="params">file</span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> filePath = path + <span class="string">'/'</span> + file;</div><div class="line">        <span class="keyword">var</span> states = fs.statSync(filePath);</div><div class="line">        <span class="keyword">if</span> (states.isDirectory())</div><div class="line">        &#123;</div><div class="line">            <span class="comment">// 如果是一个文件夹，就再次读取里面</span></div><div class="line">            readFile(filePath);</div><div class="line">        &#125; <span class="keyword">else</span></div><div class="line">        &#123;</div><div class="line">            <span class="comment">// 看一下是不是图片， 是的话就开始压缩</span></div><div class="line">            <span class="keyword">if</span> (filePath.substr(<span class="number">-3</span>, <span class="number">3</span>) === <span class="string">'png'</span> || filePath.substr(<span class="number">-3</span>, <span class="number">3</span>) === <span class="string">'jpg'</span>)</div><div class="line">            &#123;</div><div class="line">                tinify.fromFile(filePath).toFile(filePath);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="用法："><a href="#用法：" class="headerlink" title="用法："></a>用法：</h3><p>在当前文件夹app\dev-static\tester\tinyimg下打开命令行</p>
<p>输入”node tinyimg {你要压缩的文件夹}”</p>
<p>注：文件夹路径是以app/v2为起点</p>
<h3 id="示例："><a href="#示例：" class="headerlink" title="示例："></a>示例：</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">node tinyimg zt/<span class="number">2017</span>/whisper</div><div class="line">node tinyimg views/musician</div></pre></td></tr></table></figure>
<h3 id="注意事项："><a href="#注意事项：" class="headerlink" title="注意事项："></a>注意事项：</h3><ul>
<li>暂时只支持 zt和views两个文件夹。</li>
</ul>
</div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2017-08-18</span><i class="fa fa-tag"></i><a href="/Blog/tags/脚本/" title="脚本" class="tag">脚本 </a><a href="/Blog/tags/node-js/" title="node.js" class="tag">node.js </a></div></div></div></div><div class="share"><div class="evernote"><a href="javascript:(function(){EN_CLIP_HOST='http://www.evernote.com';try{var%20x=document.createElement('SCRIPT');x.type='text/javascript';x.src=EN_CLIP_HOST+'/public/bookmarkClipper.js?'+(new%20Date().getTime()/100000);document.getElementsByTagName('head')[0].appendChild(x);}catch(e){location.href=EN_CLIP_HOST+'/clip.action?url='+encodeURIComponent(location.href)+'&amp;title='+encodeURIComponent(document.title);}})();" ref="nofollow" target="_blank" class="fa fa-bookmark"></a></div><div class="weibo"><a href="javascript:void((function(s,d,e){try{}catch(e){}var f='http://service.weibo.com/share/share.php?',u=d.location.href,p=['url=',e(u),'&amp;title=',e(d.title),'&amp;appkey=2924220432'].join('');function a(){if(!window.open([f,p].join(''),'mb',['toolbar=0,status=0,resizable=1,width=620,height=450,left=',(s.width-620)/2,',top=',(s.height-450)/2].join('')))u.href=[f,p].join('');};if(/Firefox/.test(navigator.userAgent)){setTimeout(a,0)}else{a()}})(screen,document,encodeURIComponent));" class="fa fa-weibo"></a></div><div class="twitter"><a href="http://twitter.com/home?status=,http://wqy.fun/Blog/2017/08/18/tinyimg/,清野流云,一个一键压缩图片的小脚本,;" class="fa fa-twitter"></a></div></div><div class="pagination"><ul class="clearfix"><li class="pre pagbuttons"><a role="navigation" href="/Blog/2017/08/21/codewars-1/" title="CodeWars题目练习 - 1 (转换字符串)" class="btn">上一篇</a></li><li class="next pagbuttons"><a role="navigation" href="/Blog/2017/08/15/新博客/" title="新博客" class="btn">下一篇</a></li></ul></div></div></div></div></div><script src="/Blog/js/jquery.js"></script><script src="/Blog/js/jquery-migrate-1.2.1.min.js"></script><script src="/Blog/js/jquery.appear.js"></script></body></html>